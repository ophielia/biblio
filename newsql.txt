/**  lending key **/
insert into select_key (id, lookup,version) values (nextval('hibernate_sequence'),'lendtypeselect',0);

insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'All',1,'1',true,'en',0,(select id from select_key where lookup='lendtypeselect'));
insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'Checked out',2,'2',true,'en',0,(select id from select_key where lookup='lendtypeselect'));
insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'Overdue',3,'3',true,'en',0,(select id from select_key where lookup='lendtypeselect'));

insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'Toutes',1,'1',true,'fr',0,(select id from select_key where lookup='lendtypeselect'));
insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'Emprunt�',2,'2',true,'fr',0,(select id from select_key where lookup='lendtypeselect'));
insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'En retard',3,'3',true,'fr',0,(select id from select_key where lookup='lendtypeselect'));


/** class select */
insert into select_key (id, lookup,version) values (nextval('hibernate_sequence'),'classselect',0);

insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'All',1,'1',true,'en',0,(select id from select_key where lookup='classselect'));
insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'Toutes',1,'1',true,'fr',0,(select id from select_key where lookup='classselect'));


/** time period select */
insert into select_key (id, lookup,version) values (nextval('hibernate_sequence'),'timeperiodselect',0);

insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'This Week',1,'1',true,'en',0,(select id from select_key where lookup='timeperiodselect'));
insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'This Month',2,'2',true,'en',0,(select id from select_key where lookup='timeperiodselect'));
insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'Last Three Months',3,'3',true,'en',0,(select id from select_key where lookup='timeperiodselect'));
insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'School Year',4,'4',true,'en',0,(select id from select_key where lookup='timeperiodselect'));
insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'All',5,'5',true,'en',0,(select id from select_key where lookup='timeperiodselect'));

insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'cette semaine',1,'1',true,'fr',0,(select id from select_key where lookup='timeperiodselect'));
insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'ce mois',2,'2',true,'fr',0,(select id from select_key where lookup='timeperiodselect'));
insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'trois derniers mois',3,'3',true,'fr',0,(select id from select_key where lookup='timeperiodselect'));
insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'ann�e Scolaire',4,'4',true,'fr',0,(select id from select_key where lookup='timeperiodselect'));
insert into select_value (id, display,disporder,value,active,languagekey,version,keyid) values (nextval('hibernate_sequence'),'tous',5,'5',true,'fr',0,(select id from select_key where lookup='timeperiodselect'));

/** new view **/
CREATE OR REPLACE VIEW loanrecorddisplay AS 
 SELECT r.returned IS NOT NULL AND r.returned > r.duedate AS returnedlate,
    r.returned IS NULL AND now() > r.duedate AS currentlyoverdue,
    r.returned IS NULL AS currentlycheckedout,
    r.returned IS NOT NULL AND r.returned > r.duedate OR r.returned IS NULL AND now() > r.duedate AS overdue,
    r.id AS loanrecordid,
    r.borrower AS borrowerid,
    r.client AS clientid,
    r.book AS bookid,
    p.schoolgroup AS classid,
    p.firstname AS borrowerfn,
    p.lastname AS borrowerln,
    bd.title AS booktitle,
    b.clientbookid AS bookclientid,
    b.clientbookidsort AS bookclientidsort,
    concat(concat(auth.firstname, ' '), auth.lastname) AS author,
    b.clientshelfcode AS shelfclass,
    r.checkoutdate AS checkedout,
    r.returned,
    r.duedate,
    tch.firstname AS teacherfirstname,
    tch.lastname AS teacherlastname,
    tch.psn_type::text = 'TeacherDao'::text AS isteacher
   FROM loanrecord r
   JOIN book b ON r.book = b.id
   JOIN bookdetail bd ON bd.id = b.bookdetail
   JOIN person p ON p.id = r.borrower
   LEFT JOIN person tch ON r.teacherid = tch.id AND tch.psn_type::text = 'TeacherDao'::text
   LEFT JOIN book_author ba ON ba.bookdetail_id = bd.id AND ba.authororder = 0
   LEFT JOIN artist auth ON auth.id = ba.artist_id;


